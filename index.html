<!DOCTYPE html>
<html>
<head>
    <title>Browser Extensions</title>
    <meta charset='utf-8'>
    <style>
        table, td, th {
            border: 1px solid black;
            padding: 8px;
            font-size: 11pt;
        }
        
        table {
            border-collapse: collapse;
        }
    </style>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
	shortName: "browserext",
	edDraftURI:"https://browserext.github.io/browserext/",

	specStatus: "CG-DRAFT",
	editors: [
	  {
	    name: "Mike Pietraszak",
	    company:"Microsoft Corporation"
	  }
	],

	wg: "Browser Extension Community Group",
	wgURI: "https://www.w3.org/community/browserext/",

	otherLinks: [{
	  key: 'Participation',
	  data: [
	    {
	      value: 'GitHub repository',
	      href: 'https://github.com/browserext/browserext/'
	    },
	    {
	      value: 'File a bug / view open issues',
	      href: 'https://github.com/browserext/browserext/issues'
	    }
	  ]
	}],
      };
    </script>
</head>
<body>
    <section id='abstract'>
        <p>
            Modern browsers can add new functionality to sites and the browser itself through
            script-based extensions. This document specifies an API set that allows developers
            to create interoperable extensions for browsers that support the API set,
            as well as the packaging format to be used for such extensions.
        </p>
    </section>
    <section id='sotd'>
        <p>
            If you wish to make comments regarding this document, please file issues on
            <a href="https://github.com/browserext/browserext/issues/">github</a>.
            A <a href="mailto:public-browserext@w3.org">public mailing list</a>
            (<a href="mailto:public-browserext-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="http://lists.w3.org/Archives/Public/public-browserext/">archives</a>)
            is also available,
            but is reserved for high level discussions,
            and is not appropriate for specific comments about this document.
        </p>
        <p>
            Work on this document is governed by
            <a href="http://browserext.github.io/charter/">the charter</a> of the Browser Extension CG,
            which includes among other things the <a href="http://browserext.github.io/charter/#communication">Communication</a>,
            <a href="http://browserext.github.io/charter/#decision-policy">Decision</a>,
            and <a href="http://browserext.github.io/charter/#contribution-mechanics">Contribution</a> policies
            of this community group.
        </p>
    </section>

    <section class='informative'>
        <h2>Introduction</h2>
        <p>
            Because browsers supported different add-on models, extension authors wound up creating divergent codebases and delivering different browser-specific add-ons. This Community Group's goal is to make browser extension code much more interoperable across browsers by specifying common extension interfaces and well-defined browser behavior. This will allow extension authors to greatly reduce or eliminate the rework necessary to create extensions that target different browsers.
        </p>
    </section>

    <section >
        <h2>Core APIs</h2>
        <p>
            The goal for these core APIs is to provide functionality that extension authors need for: 
        </p>
        <p class="issue">Need to correct use of keywords from RFC 2119 https://dev.w3.org/2008/video/mediaann/ReSpec.js/documentation.html (MUST, MAY, SHALL, etc)<br/><a href="https://github.com/browserext/browserext/issues/15">GitHub Issue 15</a></p>
        <p class="issue">Need to update &lt;section&gt; tags with appropriate class='informative' ("This section is non-normative.") usage. Some sections ARE normative, but the class tag remains due to cut-and-paste without appropriate clean-up by the Editor afterwards.<br /><a href="https://github.com/browserext/browserext/issues/16">GitHub Issue 16</a></p>
        <ul>
            <li>page modification for web site content</li>
            <li>UI augmentation for web browsers (host apps)</li>
            <li>network request modification</li>
            <li>passing data between extensions</li>
            <li>passing data from Internet-hosted web pages to extensions</li>
            <li>accessing user settings such as cookies</li>
        </ul>
        <p class="issue">Need to resolve ID issue before we can address messaging ('passing data')<br />GitHub Issues <a href="https://github.com/browserext/browserext/issues/14">14</a>&nbsp;&amp;&nbsp;<a href="https://github.com/browserext/browserext/issues/17">17</a></p>
        <section class='informative'>
            <h3 id="apiavailability">API Availability</h3>
            <p>
                Browser extensions are authored primarily with JavaScript. In addition to the usual <a href="https://www.w3.org/standards/webdesign/script">JavaScript Web APIs</a>, additional APIs are available exclusively to extensions via the <code>browser</code> object. However, the specific APIs that are available to an extension from the <code>browser</code> object are dependent upon:
            </p>
            <ul>
                <li>Execution context (e.g. background/event, popup, options, content, extension page)
                <li>Keys declared in the manifest (e.g. browser_action, page_action)
                <li>Permissions declared in the manifest (e.g. contextMenu, tabs, webNavigation, webRequest)
                <li>Content Security Policy (CSP) for the extension and target web page (for content scripts)
            </ul>
            <section>
                <h4 id="availability-csp">Content Security Policy (CSP) Restrictions</h4>
                <p>
                    Use of some JavaScript APIs such as <code>eval()</code> are restricted due to CSP. If an explicit policy is not specified, the default policy is applied. The default CSP is discussed in the specification [[CSP3]] . The browser extension author may also override the default and specify a new CSP.</p>
                <p class="issue">Add a separate non-normative section on how content scripts interact with CSP<br/><a href="https://github.com/browserext/browserext/issues/18">GitHub Issue 18</a></p>
                <ul>
                    <li>Script execution via <code>eval()</code> and inline script execution are not allowed</li>
                    <li>Only script from the extension's package can be executed</li>
                    <li>Executing script from the web is not allowed</li>
                </ul>
            </section>

            <section class="informative">
                <h4>Execution Context and Manifest Restrictions</h4>
                    <p>
                        Browser extension pages and their corresponding scripts are executed in one of the following contexts. The manifest declarations required to create each specific type of page are described below.
                    </p>
                    <ul>
                        <li>
                            <b>Browser extension contexts ("Window")</b> - Most extension APIs are available to this context
                            <ul>
                                <li><b>Background page</b> - use the "background" manifest key and specify "persistent" true </li>
                                <li><b>Event page</b> - use the "background" manifest key and specify "persistent" false </li>
                                <li><b>Popup page</b> - use the "browser_action" or "page_action" manifest key and specify "detault_popup" </li>
                                <li><b>Options page</b> - use the "options_page" manifest key </li>
                                <li><b>Custom page</b> - such as "browserext:&#x2F;&#x2F;&lt;ext_id&gt;&#x2F;myCustomPage.html" </li>
                            </ul>
                        </li>
                        <li><b>Content script context</b> - A limited number of APIs are available to script that extensions use to interact with hosted web site pages
                        <li><b>Internet-hosted web page context</b> - Messaging APIs can be used to send messages from hosted web site pages such as https://en.wikipedia.org/wiki/Main_Page/index.html or https://w3c.github.io/html/index.html to extensions
                    </ul>

                <section class="informative">
                    <h5 id="availability-manifest">Table: API Availability Summary</h5>
                    <p>
                        Some browser extension API require a specific manifest key or specific permission. If the key or permission are not declared or not granted, the object will not be available for scripting. These requirements are summarized in the table below. If manifest keys that are not defined in this specification are specified, other browsers may ignore those keys.
                    </p>
                    <table>
                        <tr>
                            <th rowspan=2>API object</th>
                            <th colspan=3>Execution Context</th>
                            <th colspan=1>Required Declaration</th>
                        </tr>
                        <tr>
                            <th>Background page,Event page,Popup page,Options page,Custom page</th>
                            <th>Content script page</th>
                            <th>Internet-hosted web page</th>
                            <th>Manifest key</th>
                        </tr>
                        <tr>
                            <th><code>browserAction</code></th>
                            <td>Y<sup><a href="#note1">1</a></sup></td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td>"browser_action"<sup><a href="#note1">1</a></sup></td>
                        </tr>
                        <tr>
                            <th><code>contextMenus</code></th>
                            <td>Y</td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td>"permissions":["context_menus"]</td>
                        </tr>
                        <tr>
                            <th><code>extension</code></th>
                            <td>Y</td>
                            <td>Y</td>
                            <td><p></p></td>
                            <td><p></p></td>
                        </tr>
                        <tr>
                            <th><code>i18n</code></th>
                            <td>Y</td>
                            <td>Y</td>
                            <td><p></p></td>
                            <td>"default_lang" : "&lt;lang&gt;"<sup><a href="#note4">4</a></sup></td>
                        </tr>
                        <tr>
                            <th><code>pageAction</code></th>
                            <td>Y<sup><a href="#note1">1</a></sup></td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td>"page_action"<sup><a href="#note1">1</a></sup></td>
                        </tr>
                        <tr>
                            <th><code>runtime</code></th>
                            <td>Y</td>
                            <td>Y</td>
                            <td>Y<sup><a href="#note3">3</a></sup></td>
                            <td>“externally_connectable”:[...] <sup><a href="#note2">2</a></sup></td>
                        </tr>
                        <tr>
                            <th><code>tabs</code></th>
                            <td>Y</td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td>"permissions":["tabs","activeTab"]</td>
                        </tr>
                        <tr>
                            <th><code>webNavigation</code></th>
                            <td>Y</td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td>"permissions":["webNavigation"]</td>
                        </tr>
                        <tr>
                            <th><code>webRequest</code></th>
                            <td>Y</td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td>"permissions":["webRequest"]</td>
                        </tr>
                        <tr>
                            <th><code>windows</code></th>
                            <td>Y</td>
                            <td><p></p></td>
                            <td><p></p></td>
                            <td><p></p></td>
                        </tr>
                    </table>
                    <div id="note1" resource="#note1">
                        <sup>1</sup> Either <code>browserAction</code> or <code>pageAction</code> may be supported by an extension, not both
                    </div>
                    <div id="note2" resource="#note2">
                        <sup>2</sup>Extensions may use the runtime object without declaring <code>"externally_connectable"</code> in the manifest. However, an extension may only receive messages sent from hosted web pages if this key is declared. It may also be used to block messages from other extensions, except for those in the <code>"ids"</code> list.
                    </div>
                    <div id="note3" resource="#note3">
                        <sup>3</sup>Internet-hosted web pages may send messages to extensions via runtime.sendMessage if the extension has explicitly specified the hosting site's domain in the manifest under the "externally_connectable" key.
                    </div>
                    <div id="note4" resource="#note4">
                        <sup>4</sup> Use of the <code>browser.i18n</code> object does not require a manifest permission declaration. However, the manifest does require a value (<code>default_locale</code>) that is necessary and cannot be specified by the extension author in script code.
                    </div>
                </section>
            </section>
            <section >
                <h4 id="webidl">Expressing Availability in WebIDL</h4>
                <p>This specification uses WebIDL [[webidl]] to describe the Browser Extensions API.</p>
                <section>
                    <h4>Attribute: <code>Exposed</code></h4>
                    <p>
                        To express the aforementioned conditional situations in which certain APIs may or may not be available due to context, the following contexts are used:
                    </p>
                    <ul>
                        <li><b>Window</b> - The primary context for most browser extension APIs. This applies to background, event, popup, options and custom contexts</li>
                        <li><b>ContentScript</b> - Applies to content script context</li>
                    </ul>
                </section>
                <section>
                    <h4>Extended Attribute: <code>CheckAnyPermissions</code></h4>
                    <p>
                        To express the aforementioned conditional situations in which certain APIs may or may not be available due to expressed manifest keys or permissions, the new WebIDL extended attribute <code>"<a href="https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings#CheckAnyPermissions">CheckAnyPermissions</a>"</code> is used.
                    </p>
                    <table>
                        <tr><td><b>API object</b></td><td><b>CheckAnyPermissions Value</b></td><td><b>Manifest Key or Value</b></td></tr>
                        <tr><td>browser</td><td>"browserExt"</td><td>N/A</td></tr>
                        <tr><td>browser.browserAction</td><td>"browserExtBrowserAction"</td><td>"browserAction":[...]</td></tr>
                        <tr><td>browser.contextMenu</td><td>"browserExtContextMenus"</td><td>"permissions":["contextMenus"]</td></tr>
                        <tr><td>browser.extension</td><td>"browserExt"</td><td><p></p></td></tr>
                        <tr><td>i18n</td><td>"browserExt"</td><td>"default_language": "&lt;code&gt;"</td></tr>
                        <tr><td>pageAction</td><td>"browserExtPageAction"</td><td>"pageAction":[...]</td></tr>
                        <tr><td>runtime</td><td>"browserExt"</td><td><p></p></td></tr>
                        <tr><td>tabs</td><td>"browserExtTabs"</td><td>"permissions":["tabs"] or<br/>"permissions":["activeTab"]</td></tr>
                        <tr><td>webNavigation</td><td>"browserExtWebNavigation"</td><td>"permissions":["webNavigation"]</td></tr>
                        <tr><td>webRequest</td><td>"browserExtWebRequest"</td><td>"permissions":["webRequest"]</td></tr>
                        <tr><td>windows</td><td>"browserExt"</td><td><p></p></td></tr>

                    </table>
                </section>
                <section class="example">
                    <h4>Example: <code>browser.i18n</code></h4>
                        <p>
                            In this example, the <code>i18n</code> API should be made available to both browser host scripts (background, event, popup, options, etc.) and content scripts. Use of this API does not require a manifest permission declaration. Additionally, however, the manifest does require a value (<code>default_locale</code>) that is necessary and cannot be specified by the extension author in script code. This is expressed as a <code>BrowserExtensionManifest</code> dictionary.
                        </p>
                    <ol>
                        <li>
                            First, declare the methods for the <code>browser.i18n</code> object.

<pre class="def idl">
[NoInterfaceObject]
interface BrowserI18n {
    DOMString getMessage(DOMString messageName, sequence&lt;DOMString&gt;? substitutions);
};
</pre>
                        </li>
                        <li>
                            Next, we specify the available contexts ("Window" for background/event/popup/options...) and "ContentScript" for the content context.

<pre class="def idl">
[NoInterfaceObject, Exposed=(Window,ContentScript)] 
interface BrowserI18nAPI {
    readonly attribute BrowserI18n i18n;
};
                        </pre>
                        </li>
                        <li>
                            Connect the <code>i18n</code> object to the <code>browser.*</code> object.

<pre class="def idl">
Browser implements BrowserI18nAPI;
</pre>
                        </li>
                        <li>
                            Finally, we express the locale from manifest.json. For example <code>"default_locale": "en"</code>
                        
<pre class="def idl">
partial dictionary BrowserExtensionManifest {
    DOMString? defaultLocale;
};
</pre>
                        </li>
                    </ol>
                </section>
            </section>

        </section>

        <section>
            <h3>Events</h3>
            <section  >
                <h4>Overview</h4>
                <p>
                    Extension events are similar to DOM Events [<a href="https://www.w3.org/TR/dom/">DOM4</a>]. However, extension events are dispatched only to objects in the relevant extension scope (background, event, options, content, etc.). Script in the extension scope can observe events by calling <code>addListener()</code>.
                </p>
                <pre class="def idl">
[NoInterfaceObject]
dictionary BrowserExtRule {
    DOMString id;
    sequence&lt;DOMString&gt; tags;
    sequence&lt;Any&gt; conditions;
    sequence&lt;Any&gt; actions;
    unsigned short priority;
};
[NoInterfaceObject, Exposed=(Window,ContentScript), CheckAnyPermissions_browserExt_]
interface BrowserExtEvent {
    void    addListener(Function callback);
    void    removeListener(Function callback);
    boolean hasListener(Function callback);
    boolean hasListeners();
};
</pre>
            </section>
        </section>

        <section>
            <h3 id="coreapis">The <code>browser</code> object</h3>
            <section class="introductory">
                <h4>Overview</h4>
                <p>
                    The core Browser Extension API objects are accessible from the <code>browser</code> object. Their availability varies, depending on conditions outlined in the <a href="#apiavailability">API Availability</a> section.
                </p>
                <ul>
                    <li>browserAction</li>
                    <li>contextMenus</li>
                    <li>extension</li>
                    <li>i18n</li>
                    <li>pageAction</li>
                    <li>runtime</li>
                    <li>tabs</li>
                    <li>webNavigation</li>
                    <li>webRequest</li>
                    <li>windows</li>
                </ul>
            </section>
            <section class="introductory">
                <h4>Context</h4>
                <p>
                    This API is available in Window context (background, event, popup, options and custom pages), Content Script context, and Internet-hosted web page context.
                </p>
            </section>
            <section class="introductory">
                <h4>WebIDL Definition</h4>
                <p>
                    A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                </p>
<pre class="def idl">
[CheckAnyPermissions_browserExt_]
interface BrowserExtGlobal {
    readonly attribute Browser browser;
};
Window implements BrowserExtGlobal;
[NoInterfaceObject] 
interface Browser { 
};
dictionary BrowserExtIcon {
    DOMString path;
    DOMString size;
};
typedef sequence&lt;BrowserExtIcon&gt; BrowserExtIconArray;
dictionary BrowserExtDeveloper {
    DOMString name;
    DOMString? url;
};
dictionary BrowserExtBrowserOrPageAction {
    BrowserExtensionIcon defaultIcon; 
    DOMString defaultPopup;
    DOMString defaultTitle;
};
dictionary BrowserExtKeyValue {
    DOMString key;
    DOMString? value;
};
dictionary BrowserExtBrowserSpecificSettings {
    DOMString browserName;
    sequence&lt;KeyValue&gt; keyValue;
};
dictionary BrowserExtBackroundOrEvent {
    DOMString page;
    boolean persistent;
    sequence&lt;DOMString&gt; scripts;
};
dictionary BrowserExtContentScripts {
    boolean allFrames;
    sequence&lt;DOMString&gt; css;
    sequence&lt;DOMString&gt; excludeMatches;
    sequence&lt;DOMString&gt; js;
    sequence&lt;DOMString&gt; matches;
    DOMString runAt;
};
dictionary BrowserExtManifest {
    BrowserExtBackground background;
    BrowserExtBrowserAction browserAction;
    BrowserExtBrowserSpecificSettings browserSpecificSettings;
    BrowserExtContentScripts contentScripts;
    DOMString contentSecurityPolicy;
    DOMString defaultLocale;
    DOMString? description;
    BrowserExtDeveloper developer;
    BrowserExtIconArray icons;
    DOMString optionsPage;
    unsigned short manifestVersion;
    DOMString name;
    BrowserExtBrowserOrPageAction pageAction;
    sequence&lt;DOMString&gt; permissions;
    sequence&lt;DOMString&gt; requiredKeys;
    DOMString version;
    sequence&lt;DOMString&gt; webAccessibleResources;
};
</pre>
            </section>

            <section>
                <h4 id="browserAction">The <code>browserAction</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    The <code>browserAction</code> object adds an always-visible button to the browser application, usually near the top of the browser application UI in the toolbar area. An extension may have either a <code>browserAction</code> or a <code>pageAction</code>, but not both.
                </section>
                <section class="introductory">
                    <h4>Manifest</h4>
                    The <code>"browser_action"</code> and <code>"default_title"</code> keys are required. The other keys are optional.
<pre>
"browser_action": {                               // Required
    "default_icon": {...},                        // Same format as "icons"
    "default_popup": "Page URL",                  // Optional
    "default_title": "Title string"               // Required
}
</pre>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>
                    <p class="issue">Need to find all strings that support null and add ? to DOMString (DOMString?).<br /><a href="https://github.com/browserext/browserext/issues/21">GitHub Issue 21</a></p>
<pre class="def idl">
dictionary BrowserExtBrowserActionDefaults {
    BrowserExtIconArray defaultIcon;
    DOMString? defaultPopup;
    DOMString  defaultTitle;
};
partial dictionary BrowserExtManifest {
    BrowsereExtBrowserActionDefaults? browserAction;
};
typedef sequence&lt;unsigned short&gt; BrowserExtColorArray;
dictionary BrowserExtTabIdDetails {
    unsigned short tabId;
};
dictionary BrowserExtBadgeColorArrayTabId {
    ColorArray color;
    unsigned short tabId;
};
dictionary BrowserExtBadgeTextTabId {
    unsigned short tabId;
    DOMString text;
};
dictionary BrowserExtBadgePathTabId {
    DOMString path;
    unsigned short tabId;
};
dictionary BrowserExtBadgeTabIdPopup {
    DOMString popupHTMLFileName;
    unsigned short tabId;
};



callback BrowserExtBrowserActionOnClickedCallback = void (TabsTab tab);

[NoInterfaceObject]
interface BrowserExtBrowserAction {
    void disable(unsigned short tabId);
    void enable(unsigned short tabId);
    Promise&lt;ColorArray&gt; getBadgeBackgroundColor(BrowserExtTabIdDetails details);
    Promise&lt;DOMString&gt; getBadgeText(BrowserExtTabIdDetails details);
    Promise&lt;DOMString&gt; getPopup(BrowserExtTabIdDetails details);
    BrowserExtEvent onClicked(BrowserExtBrowserActionOnClickedCallback callback);
    void setBadgeBackgroundColor(BrowserExtBadgeColorArrayTabId details);
    void setBadgeText(BrowserExtBadgeTextTabId details);
    Promise&lt;void&gt; setIcon(BadgePathTabId details);
    void setPopup(BrowserExtBadgeTabIdPopup details);
};
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExtBrowserAction_]
interface BrowserExtBrowserActionAPI {
    readonly attribute BrowserExtBrowserAction browserAction; 
};
Browser implements BrowserExtBrowserActionAPI;
</pre>
                </section>
            </section>


            <section>
                <h4 id="contextMenus">The <code>contextMenus</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>contextMenus</code> object allows additional entries to be added to the browser's context menu. The menu may selectively be shown for various browser UI elements (browser action or page action button) or page elements (frame, image, link, page, selection, etc.).
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        A <code>"contextMenus"</code> entry must be declared in the <code>"permissions"</code> key. The icon keys are optional.
                    </p>
<pre>
"permissions": [                                  // Required
    "contextMenus"                                // Required
],                                                // Required
"icons": {                                        // Optional
    "&lt;size&gt;":"&lt;name.png&gt;"                         // Optional, size 16 recommended
}                                                 // Optional
</pre>
                </section><section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section><section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>
<pre class="def idl">
    enum BrowserExtContextType { "all", "audio", "browser_action", "editable", "frame", "image", "link", "page", "page_action", "selection", "video" };
enum BrowserExtItemType { "checkbox","normal","radio","separator" };
    dictionary BrowserExtContextMenuCreateDetails {
    boolean checked;
    boolean enabled;
    sequence&lt;DOMString&gt; documentUrlPatterns;
    sequence&lt;ContextType&gt; contexts;
    DOMString id;
    (unsigned short or DOMString) parentId;
    Function onclick;
    sequence&lt;DOMString&gt; targetUrlPatterns;
    DOMString title;
    DOMString type;
};
dictionary BrowserExtContextMenuUpdateDetails {
    boolean checked;
    sequence&lt;BrowserExtContextType&gt; contexts;
    sequence&lt;DOMString&gt; documentUrlPatterns;
    boolean enabled;
    Function onclick;
    unsigned short parentId;
    sequence&lt;DOMString&gt; targetUrlPatterns;
    DOMString title;
    ItemType type;
};
dictionary BrowserExtContextMenuOnClickedDetails {
    boolean checked;
    boolean editable;
    unsigned short frameId;
    DOMString frameUrl;
    DOMString linkUrl;
    DOMString mediaType;
    (unsigned short or DOMString) menuItemId;
    DOMString pageUrl;
    (unsigned short or DOMString) parentMenuItemId;             
    DOMString selectionText;
    DOMString srcUrl;
    boolean wasChecked;
};

callback BrowserExtContextMenuOnClickedCallback = void (BrowserExtContextMenuOnClickedDetails details, TabsTab tab);
[NoInterfaceObject]
interface BrowserExtContextMenus {
    Promise&lt;unsigned short&gt; create(BrowserExtContextMenuCreateDetails details);
    object onClicked(Function callback);
	Promise&lt;void&gt; remove((unsigned short or DOMString) itemId);
    Promise&lt;void&gt;  removeAll();
    Promise&lt;void&gt;  update((unsigned short or DOMString) itemId, BrowserExtContextMenuUpdateDetails details);
};
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExtContextMenus_]
interface BrowserExtContextMenusAPI {
    readonly attribute BrowserExtContextMenus contextMenus; 
};
Browser implements BrowserExtContextMenusAPI;
</pre>
                </section>
            </section>


            <section>
                <h4 id="i18n">The <code>i18n</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>i81n</code> object provides a way to access strings that have been localized into supported languages.
                    </p>
                </section>
                <section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        When providing localized strings, you must specify a default locale using a two-character code. Codes can be found at <a href="http://www.w3.org/TR/1999/REC-html401-19991224/struct/dirlang.html">RFC1766</a> or <a href="http://www.w3.org/International/articles/language-tags/">IETF BCP47</a>. To manifest localize strings, the syntax below may be used.
                    </p>
<pre>
"default_locale" : "&lt;twoCharLocaleCode&gt;",              // Required
"name" : "__MSG_&lt;yourCustomNameStringIdentifier&gt;__",
"description" : "__MSG_&lt;yourCustomDescriptionStringIdentifier&gt;__",
</pre>
                    For example
                    <pre>
"default_locale" : "en",              // English
"name" : "__MSG_MySampleExtension__",
"description" : "__MSG_MySampleExensionDecription__",
</pre>
                </section>
                <section class="introductory">
                    <h4>Localized Strings</h4>
                    <p>
                        Each supported locale must have its own <code>messages.json</code> file stored in the folder <code>_locales/&lt;twoCharLocaleCode&gt;</code>. The two-character codes used for directory names here the same as are used in the <code>mainfest.json</code> to specify <code>default_locale</code>.
                    </p>
                </section>
                <section class="introductory">
                    <h4>Locale Codes and Matching</h4>
                    <p>Locale codes used in file/directory names and returned by the API, contrary to common standards, are in the form:</p>
                    <code> &lt;language&gt;[_&lt;region&gt;] </code>
                    <p>
                        Which is to say, a two-letter language code, optionally followed by an underscore and a two-letter region code.
                        Locale codes are matched such that an exact match is used if available, falling back to the least-specific, closest match. Therefore, for "en_US", the following locales would be chosen, in order of preference:
                    </p>
                    <ul>
                        <li>en_US</li>
                        <li>en_US_var</li>
                        <li>en</li>
                        <li>en_GB</li>
                        <li>en_GB_var</li>
                    </ul>
                    </p>
                </section>
                <section class="introductory">
                    <h4>String tokens</h4>
                    <p>Strings are localized by pre-processing messages, replacing <code>|$[a-zA-Z0-9@_]+$|</code> tokens with the value of their replacements. Later, it processes the resulting string for <code>|$[0-9]|</code> replacements.<p>
                    <p>Any number of sequential |$|s are permitted, and are replaced with that number minus 1. Instances of <code>|$|</code> followed by any number of sequential digits is also permitted, but a localized string which provides more than 9 substitutions are ignored.</p>
                </section>

                <section class="introductory">
                    <h4>Locale Message Replacement</h4>
                    <p>
                        Locale messages in the form <code>__MSG_&lt;message name&gt;_</code> are automatically replaced with the appropriate localized message in CSS files and certain manifest.json string values.
                        Specifically, the replacements are done according to the regular expression <code>__MSG_([A-Za-z0-9@_]+?)__</code>, meaning that the first occurrence of __ terminates the message name immediately.
                    </p>
                    <p>
                        CSS files are pre-processed as a raw text stream, with no considerations for CSS syntax.
                        <code>manifest.json</code> values are processed after the JSON has been parsed, and the results are always treated as literal strings. The following manifest keys are processed for localization messges:
                    </p>
                    <ul>
                        <li>name</a>
                        <li>short_name</a>
                        <li>description</a>
                        <li>author</a>
                        <li>homepage_url</a>
                        <li>developer.name</a>
                        <li>developer.url</a>
                        <li>browser_action.default_title</a>
                        <li>browser_action.default_url</a>
                        <li>page_action.default_title</a>
                        <li>page_action.default_url</a>
</ul>
                    </p>
                </section>
                <section class="introductory">
                    <h4>Placeholders</h4>
                    <p>A translated string may contain substrings that will not be translated or will be replaced with variable content. For example</p>
                    <pre>
"messageExample": {
    "message": "You clicked $URL$.",
    "description": "Tells the user which link they clicked.",
    "placeholders": {
      "url" : {
        "content" : "$1"
        "example" : "https://www.w3c.org"
      }
</pre>
                    <p>The placeholder <code>name</code> ("url" in the above example) is used to represent the placeholder in the substitution string (e.g. "url" becomes $URL$). It is case insensitive and can contain the same characters as a message string name.</p>
                    <p>The <code>"content"</code> item defines the content of the placeholder. This can be a hardcoded string, such as "My placeholder", but it can also include values obtained from a i18n.getMessage() call. </p>
                    <p>The optional <code>"example"</code> item is intended to help translators by showing them an example of how the placeholder would appear to end users, allowing them to make the best choice when localizing the file.</p>
                </section>
                    <section class="introductory">
                        <h4>Predefined messages</h4>
                        <p>Predefined messages are accessed in the same way as other messages. The syntax for standard messages is:</p>
                        <code>__MSG_extensionName__</code>
                        <p>Predefined messages use exactly the same syntax, except with @@ before the message name. For example:</p>
                        <code>__MSG_@@ui_locale__</code>
                        <p>The following table shows the different available predefined messages:</p>
                        <table>
                            <tr><td><b>Message name</b></td><td><b>Description</b></td></tr>
                            <tr><td>@@extension_id</td><td>The extension or app ID; you might use this string to construct URLs for resources inside the extension. Even unlocalized extensions can use this message. Note that you can't use this message in a manifest file.</td></tr>
                            <tr><td>@@ui_locale</td><td>The current locale; you might use this string to construct locale-specific URLs.</td></tr>
                            <tr><td>@@bidi_dir</td><td>The text direction for the current locale, either "ltr" for left-to-right languages such as English or "rtl" for right-to-left languages such as Arabic.</td></tr>
                            <tr><td>@@bidi_reversed_dir</td><td>If the @@bidi_dir is "ltr", then this is "rtl"; otherwise, it's "ltr".</td></tr>
                            <tr><td>@@bidi_start_edge</td><td>If the @@bidi_dir is "ltr", then this is "left"; otherwise, it's "right".</td></tr>
                            <tr><td>@@bidi_end_edge</td><td>If the @@bidi_dir is "ltr", then this is "right"; otherwise, it's "left".</td></tr>
                        </table>
</section>
                <section class="introductory">
                        <h4>Context</h4>
                        <p>
                            This API is available in Window context (background, event, popup, options and custom pages) and Content Script context.
                        </p>
                    </section><section class="introductory">
                        <h4>WebIDL Definition</h4>
                        <p>
                            A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                        </p>

<pre class="def idl">    
[NoInterfaceObject]
interface BrowserExtI18n {
    DOMString getMessage(DOMString messageName, sequence&lt;DOMString&gt;? substitutions);
};
[NoInterfaceObject, Exposed=(Window,ContentScript), CheckAnyPermissions_browserExt_] 
interface BrowserExtI18nAPI {
        readonly attribute BrowserExtI18n i18n;
};
Browser implements BrowserExtI18nAPI;
partial dictionary BrowserExtManifest {
    DOMString? defaultLocale;
};
</pre>
                    </section>
                </section>

            <section>
                <h4 id="pageAction">The <code>pageAction</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>pageAction</code> object adds a button to the browser application, usually within the address bar. This button typically appears only when the extension has detected that it can perform an action on the current page for the active tab. An extension may have either a <code>browserAction</code> or a <code>pageAction</code>, but not both.
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        The <code>"page_action"</code> and <code>"default_title"</code> keys are required. The other keys are optional.
                    </p>
<pre>
"page_action": {                               // Required
    "default_icon": {...},                        // Same format as "icons"
    "default_popup": "Page URL",                  // Optional
    "default_title": "Title string"               // Required
}
</pre>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>

<pre class="def idl">
dictionary BrowserExtPageActionDefaults {
    BrowserExtIconArray defaultIcon;
    DOMString? defaultPopup;
    DOMString  defaultTitle;
};
partial dictionary BrowserExtManifest {
    BrowserExtPageActionDefaults? pageAction;
};
dictionary BrowserExtBadgePath {
    DOMString path;
};

callback BrowserExtPageActionOnClickedCallback = void (TabsTab tab);

interface BrowserExtPageAction {
    Promise&lt;DOMString&gt; getPopup(BrowserExtTabIdDetails details);
    Promise&lt;DOMString&gt; getTitle(BrowserExtTabIdDetails details);
    void hide(unsigned short tabId);
    BrowserExtensionEvent onClicked(BrowserExtPageActionOnClickedCallback callback);
    Promise&lt;void&gt; setIcon(BrowserExtBadgePath path);
    void setPopup(BrowserExtBadgePathTabId details);
    void setTitle(BrowserExtBadgeTextTabId details);
    void show(unsigned short tabId);
};
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExtPageAction_]
interface BrowserExtPageActionAPI {
    readonly attribute BrowserExtPageAction pageAction; 
};
Browser implements BrowserExtPageActionAPI;
</pre>
                </section>
            </section>

            <section>
                <h4 id="runtime">The <code>runtime</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>runtime</code> object is used to send and receive messages across contexts, as well as access extension-level information such as the id, manifest, and absolute path to resources.
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        There are no additional manifest entries required for an extension to use this object. However, an extension may only receive messages sent from hosted web pages if the “externally_connectable” key is declared. Also, an extension may block messages from other extensions by specifying only approved extensions. Note that if this key is used to allow web pages to send messages, unless <code>"ids" : ["*"]</code> is specified, all messages from other extensions will be blocked. URLs in the <code>"matches"</code> array must include a top-level domain. This list does not affect content scripts.
                    </p>
<pre>
"externally_connectable" : [
    "ids":[...], // Identifiers for other extensions that are allowed to send messages
    "matches":[...] // URL patterns for hosted web pages allowed to send messages 
    ]
</pre>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages), Content Script context, and Internet-hosted web page context.
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>
<pre class="def idl">
enum BrowserExtRuntimeOnInstalledReason {"browser_update", "extension_install", "extension_update"};

dictionary BrowserExtRuntimeOnInstalledDetails {
    BrowserExtRuntimeOnInstalledReason reason;
    DOMString previousVersion;
    DOMString id;
};
dictionary BrowserExtRuntimePort {
    Function disconnect;
    DOMString name;
    object onDisconnect;
    object onMessage;
    Function postMessage;
    MessageSender sender;
};
dictionary BrowserExtRuntimeMessageSender {
    DOMString id;
    unsigned short frameId;
    BrowserExtTabsTab tab;
    DOMString url;
};

callback BrowserExtRuntimeOnConnectCallback = void (BrowserExtRuntimePort port);
callback BrowserExtRuntimeOnInstalledCallback = void (BrowserExtRuntimeOnInstalledDetails details);
callback BrowserExtRuntimeOnMessageCallback = void (optional any message, BrowserExtRuntimeMessageSender sender, BrowserExtRuntimeSendResponseCallback callback);

[NoInterfaceObject]
interface BrowserExtBrowserRuntime {
    object getManifest();
    DOMString getURL(DOMString path);
    attribute DOMString id;
    void onConnect(BrowserExtRuntimeOnConnectCallback callback);
    void onInstalled(BrowserExtRuntimeOnInstalledCallback callback);
    void onMessage(BrowserExtRuntimeOnMessageCallback callback);
    Promise&lt;any&gt; sendMessage(optional DOMString extensionId, any message);
    attribute RuntimePort Port;
    attribute RuntimeMessageSender MessageSender;
};
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExt_]
interface BrowserExtRuntimeAPI {
    readonly attribute BrowserExtRuntime runtime; 
};
Browser implements BrowserExtRuntimeAPI;
</pre>
                </section>
            </section>

            <section>
                <h4 id="tabs">The <code>tabs</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>tabs</code> object is used to access metadata about a tab, such as its title, or to access the current content within the tab itself.
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        The <code>"tabs"</code> permission is required to use this object.
                    </p>
<pre>
{
    "permissions": [                               // Required
        "tabs"                                     // Either "tabs" or "activeTab" is required
        "activeTab"                                // Either "tabs" or "activeTab" is required
    ]                                              // Required   
}
</pre>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>
                    <pre class="def idl">

enum BrowserExtTabMutedReasonDetails { "user", "capture", "extension" };
enum BrowserExtRunAt { "document_end", "document_idle", "document_start" };
enum BrowserExtTabStatus { "complete", "loading" };
enum BrowserExtWindowTypes { "app", "normal", "panel", "popup" };
enum BrowserExtTabsCaptureVisibleTabFormat { "jpeg", "png" };

dictionary BrowserExtTabsTab {
    boolean active;
    boolean audible;
    DOMString favIconUrl;
    boolean highlighted;
    unsigned short height;
    unsigned short id;
    boolean incognito;
    unsigned short index;
    TabMutedDetails mutedDetails;
    unsigned short openerTabId;
    boolean pinned;
    DOMString sessionId;
    DOMString status;
    DOMString title;
    DOMString url;
    unsigned short width;
    unsigned short windowId;
};

dictionary BrowserExtTabMutedDetails {
    DOMString extensionId;
    boolean muted;
    TabMutedReasonDetails reason;
};
    dictionary BrowserExtTabConnectDetails {
    unsigned short frameId;
    DOMString name;
};
dictionary BrowserExtTabCreateDetails {
    boolean active;
    unsigned short index;
    unsigned short openerTabId;
    boolean pinned;
    DOMString url;
    unsigned short windowId;
};


dictionary BrowserExtTabScriptAndCSSDetails {
    boolean allFrames;
    DOMString code;
    DOMString file;
    unsigned short frameId;
    boolean matchAboutBlank;
    BrowserExtRunAt runAt;
};


dictionary BrowserExtTabsCaptureVisibleTabDetails {
    BrowserExtTabsCaptureVisibleTabFormat imageCaptureormat;
    unsigned short jpegQuality;
};
dictionary BrowserExtTabQueryDetails {
    boolean active;
    boolean audible;  
    boolean currentWindow;
    boolean highlighted;
    unsigned short index;
    boolean lastFocusedWindow;
    boolean muted;
    boolean pinned;
    TabStatus status;
    DOMString title;
    (DOMString or sequence&lt;DOMString&gt;) url;
    unsigned short windowId;
    WindowType windowType;
};
dictionary BrowserExtTabReloadDetails {
    boolean bypassCache;
};
dictionary BrowserExtTabSendMessageDetails {
    unsigned short frameId;
};
dictionary BrowserExtTabUpdateDetails {
    boolean active;
    boolean highlighted;
    boolean muted;
    unsigned short openerTabId;
    boolean pinned;
    DOMString url;
};
dictionary BrowserExtTabIdWindowId {
    unsigned short tabId;
    unsigned short windowId;
};
dictionary BrowserExtTabsWindowIdIsWindowClosing {
    boolean isWindowClosing;
    unsigned short tabId;
};
dictionary BrowserExtTabsOnUpdatedChangeDetails {
    boolean audible;    
    DOMString favIconUrl;
    TabMutedDetails mutedDetails;
    boolean pinned;
    DOMString status;
    DOMString title;
    DOMString url;
};
callback BrowserExtTabsOnActivatedCallback = void (BrowserExtTabIdWindowId activeDetails);
callback BrowserExtTabsOnCreatedCallback = void (BrowserExtTabTab tab);
callback BrowserExtTabsOnRemovedCallback = void (BrowserExtTabsWindowIdIsWindowClosing removeDetails);
callback BrowserExtTabsOnUpdatedCallback = void (unsigned short tabId, BrowserExtTabsOnUpdatedChangeDetails details, TabsTab tab);

[NoInterfaceObject]
interface BrowserExtBrowserTabs {
    Promise&lt;DOMString&gt; captureVisibleTab(unsigned short windowId, BrowserExtTabsCaptureVisibleTabDetails details);
    RuntimePort connect(unsigned short tabId, BrowserExtTabConnectDetails details);
    Promise&lt;BrowserExtTabsTab&gt; create(BrowserExtTabCreateDetails details);
    void executeScript(unsigned short tabId, BrowserExtTabScriptAndCSSDetails details);
    Promise&lt;BrowserExtTabsTab&gt; get(unsigned short tabId);
    Promise&lt;BrowserExtTabsTab&gt; getCurrent();
    void insertCSS(unsigned short tabId, BrowserExtTabScriptAndCSSDetails details);
    void onActivated(BrowserExtTabsOnActivatedCallback callback);
    void onCreated(BrowserExtTabsOnCreatedCallback callback);
    void onRemoved(BrowserExtTabsOnRemovedCallback callback);
    void onUpdated(BrowserExtTabsOnUpdatedCallback callback);
    Promise&lt;BrowserExtTabsTab&gt; query(BrowserExtTabQueryDetails queryDetails);
    Promise&lt;void&gt; reload(BrowserExtTabReloadDetails details);
    Promise&lt;void&gt; remove((unsigned short or sequence&lt;unsigned short&gt;) tabIds);
    Promise&lt;any&gt;sendMessage(unsigned short tabId, any message, optional BrowserExtTabSendMessageOptions details);
    Promise&lt;BrowserExtTabsTab&gt; update(optional unsigned short tabId, BrowserExtTabUpdateDetails details);
};
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExtTabs_]
interface BrowserExtTabsAPI {
readonly attribute BrowserExtTabs tabs; 
};
Browser implements BrowserExtTabsAPI;
</pre>
                </section>
            </section>


            <section>
                <h4 id="webNavigation">The <code>webNavigation</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>webNavigation</code> object is used to monitor events related to networking requests.
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        The <code>"webNavigation"</code> permission is required to use this object.
                    </p>
<pre>
{
    "permissions": [                               // Required
        "webNavigation"                            // Required
    ]                                              // Required   
}
</pre>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>

<pre class="def idl">
enum BrowserExtTransitionType { "link", "typed" };
dictionary BrowserExtWebNavigationOnBeforeNavigateDetails {
    unsigned short frameId;
    unsigned short parentFrameId;
    unsigned short tabId;
    double timeStamp;
    DOMString url;
};
dictionary BrowserExtWebNavigationOnCommittedDetails {
    unsigned short frameId;
    unsigned short processId;
    unsigned short tabId;
    double timeStamp;
    TransitionType transitionType;
    DOMString url;
};
dictionary BrowserExtWebNavigationOnCompletedDetails {
    unsigned short frameId;
    unsigned short processId;
    unsigned short tabId;
    double timeStamp;
    DOMString url;
};
dictionary BrowserExtWebNavigationOnDOMContentLoadedDetails {
    unsigned short frameId;
    unsigned short processId;
    unsigned short tabId;
    double timeStamp;
    DOMString url;
};
dictionary BrowserExtWebNavigationOnErrorOccurredDetails {
    DOMString error;
    unsigned short frameId;
    unsigned short tabId;
    double timeStamp;
    DOMString url;
};
dictionary BrowserExtWebNavigationOnReferenceFragmentUpdatedDetails {
    unsigned short frameId;
    unsigned short processId;
    unsigned short tabId;
    double timeStamp;                           
    BrowserExtTransitionType transitionType;
    DOMString url;
};
callback BrowserExtWebNavigationOnBeforeNavigateCallback = void (BrowserExtWebNavigationOnBeforeNavigateDetails details);
callback BrowserExtWebNavigationOnCommittedCallback = void (BrowserExtWebNavigationOnCommittedDetails details);
callback BrowserExtWebNavigationOnCompletedCallback = void (BrowserExtWebNavigationOnCompletedDetails details);
callback BrowserExtWebNavigationOnDOMContentLoadedCallback = void (BrowserExtWebNavigationOnDOMContentLoadedDetails details);
callback BrowserExtWebNavigationOnErrorOccurredCallback = void (BrowserExtWebNavigationOnErrorOccurredDetails details);
callback BrowserExtWebNavigationOnReferenceFragmentUpdated = void (BrowserExtWebNavigationOnReferenceFragmentUpdatedDetails details);
[NoInterfaceObject]
interface BrowserExtBrowserWebNavigation {
    void onBeforeNavigate(BrowserExtWebNavigationOnBeforeNavigateCallback callback);
    void onCommitted(BrowserExtWebNavigationOnCommittedCallback callback);
    void onCompleted(BrowserExtWebNavigationOnCompletedCallback callback);
    void onDOMContentLoaded(BrowserExtWebNavigationOnDOMContentLoadedCallback callback);
    void onErrorOccurred(BrowserExtWebNavigationOnErrorOccurredCallback callback);
    void onReferenceFragmentUpdated(BrowserExtWebNavigationOnReferenceFragmentUpdated callback);
};
    
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExtWebNavigation_]
interface BrowserExtWebNavigationAPI {
    readonly attribute BrowserExtWebNavigation webNavigation; 
};
Browser implements BrowserExtWebNavigationAPI;
</pre>
                </section>
            </section>


            <section>
                <h4 id="webRequest">The <code>webRequest</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>webRequest</code> object is used to modify or cancel networking requests.
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        The <code>"webRequest"</code> permission is required to use this object.
                    </p>
<pre>
{
    "permissions": [                           // Required
        "webRequest"                            // Required
        "webRequestBlocking"                    // Optional
        "&lt;URL pattern&gt;"                         // Optional, e.g. "*://*.w3c.org/"
    ]                                          // Required   
}
</pre>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>
                    <p class="issue">##27## 
                        <code>unsigned short</code> was used in many places in this spec to represent both unsigned integers and signed integers. Need to go back and find the places where negative numbers are allowed and changed from unsigned short to short.<br />
                        NOTE: Frame ID can be 64-bit (long), ask Kris about others<br /> 
</p>
<pre class="def idl">
enum BrowserExtResourceType { "main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object", "xmlhttprequest", "ping", "other" };
dictionary BrowserExtWebRequestUploadDetails {
    any bytes;
    DOMString file;
};
dictionary BrowserExtWebRequestRequestBody {
    DOMString error;
    object formData;
    sequence&lt;BrowserExtWebRequestUploadData&gt; rawData;
};
dictionary BrowserExtWebRequestHttpHeader {
    DOMString keyName;
    any value;
};
dictionary BrowserExtWebRequestHttpHeaders {
    sequence&lt;BrowserExtWebRequestHttpHeader&gt; data; 
};
dictionary BrowserExtWebRequestOnBeforeRequestDetails {
    unsigned short frameId;
    DOMString method;
    unsigned short parentFrameId;
    BrowserExtWebRequestRequestBody requestBody;
    DOMString requestId;
    unsigned short tabId;
    double timeStamp;
    BrowserExtResourceType type;
    DOMString url;
};
dictionary BrowserExtWebRequestOnBeforeSendHeadersDetails {
    unsigned short frameId;
    DOMString method;
    unsigned short parentFrameId;
    DOMString requestId;
    unsigned short tabId;
    double timeStamp;
    BrowserExtResourceType type;
    DOMString url;
};
dictionary BrowserExtWebRequestOnCompletedDetails {
    unsigned short frameId;
    boolean fromCache;
    DOMString method;
    unsigned short parentFrameId;
    DOMString requestId;
    BrowserExtWebRequestHttpHeaders responseHeaders;
    DOMString serverIP;
    unsigned short statusCode;
    DOMString statusLine;
    unsigned short tabId;
    double timeStamp;   
    BrowserExtResourceType type;
    DOMString url;
}; 
dictionary BrowserExtWebRequestOnHeadersReceivedDetails {
    unsigned short frameId;
    DOMString method;
    unsigned short parentFrameId;
    BrowserExtWebRequestHttpHeaders responseHeaders;
    DOMString requestId;
    unsigned short statusCode;
    DOMString statusLine;
    unsigned short tabId;
    double timeStamp;   
    BrowserExtResourceType type;
    DOMString url;
};
dictionary BrowserExtWebRequestOnSendHeadersDetails {
    unsigned short frameId;
    DOMString method;
    unsigned short parentFrameId;
    BrowserExtWebRequestHttpHeaders requestHeaders;
    DOMString requestId;
    unsigned short tabId;
    double timeStamp;   
    BrowserExtResourceType type;
    DOMString url;
};
callback BrowserExtWebRequestOnBeforeRequestCallback = void (BrowserExtWebRequestOnBeforeRequestDetails details);
callback BrowserExtWebRequestOnBeforeSendHeadersCallback = void (BrowserExtWebRequestOnBeforeSendHeadersDetails details);
callback BrowserExtWebRequestOnCompletedCallback = void (BrowserExtWebRequestOnCompletedDetails details);
callback BrowserExtWebRequestOnHeadersReceivedCallback = void (BrowserExtWebRequestOnHeadersReceivedDetails details);
callback BrowserExtWebRequestOnSendHeadersCallback = void (BrowserExtWebRequestOnSendHeadersDetails details);
[NoInterfaceObject]
interface BrowserExtBrowserWebRequest {
    void onBeforeRequest(BrowserExtWebRequestOnBeforeRequestCallback callback);
    void onBeforeSendHeaders(BrowserExtWebRequestOnBeforeSendHeadersCallback callback);
    void onCompleted(BrowserExtWebRequestOnCompletedCallback callback);
    void onHeadersReceived(BrowserExtWebRequestOnHeadersReceivedCallback callback);
    void onSendHeaders(Function callback);
};
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExtWebRequest_]
interface BrowserExtWebRequestAPI {
    readonly attribute BrowserExtWebRequest webRequest; 
};
Browser implements BrowserWebRequestAPI;
</pre>
                </section>
            </section>

            <section>
                <h4 id="windows">The <code>windows</code> object</h4>
                <section class="introductory">
                    <h4>Overview</h4>
                    <p>
                        The <code>windows</code> object is used to access the UI windows managed by the browser.
                    </p>
                </section><section class="introductory">
                    <h4>Manifest</h4>
                    <p>
                        There are no additional manifest entries required for an extension to use this object.
                    </p>
                </section>
                <section class="introductory">
                    <h4>Context</h4>
                    <p>
                        This API is available in Window context (background, event, popup, options and custom pages).
                    </p>
                </section>
                <section class="introductory">
                    <h4>WebIDL Definition</h4>
                    <p>
                        A description of the special <a href="#webidl">WebIDL syntax considerations</a> for browser extensions are defined elsewhere in this document.
                    </p>

<pre class="def idl">
enum BrowserExtWindowsWindowType { "detached_panel", "normal", "panel", "popup" };
enum BrowserExtWindowsWindowState { "docked", "fullscreen", "maximized", "minimized", "normal" };
dictionary BrowserExtCreateWindowDetails {
    boolean focused;
    unsigned short height;
    boolean incognito;
    unsigned short left;
    unsigned short tabId;
    unsigned short top;
    (DOMString or sequence&lt;DOMString&gt;) url;
    BrowserExtWindowsWindowState state;
    unsigned short width;
    BrowserExtWindowsWindowType windowType;
};
dictionary BrowserExtGetWindowDetails {
    boolean populate;
    sequence&lt;BrowserExtWindowTypes&gt; windowTypes;
};
dictionary BrowserExtWindowUpdateDetails {
    boolean drawAttention;
    boolean focused;
    unsigned short height;
    unsigned short left;
    unsigned short top;
    unsigned short width;
    BrowserExtWindowState windowState;
};
    dictionary BrowserExtWindowsWindow {
    boolean alwaysOnTop;
    boolean focused;
    unsigned short height;
    unsigned short id;
    boolean incognito;
    unsigned short left;
    sequence&lt;TabsTab&gt; tabs;
    unsigned short top;
    DOMString sessionId;
    BrowserExtWindowsWindowState state;
    unsigned short width;
    BrowserExtWindowsWindowType windowType;
};
callback BrowserExtWindowsOnFocusChangedCallback = void ( windowId);
[NoInterfaceObject]
interface BrowserExtWindows {
    Promise&lt;BrowserExtWindowsWindow&gt; create(CreateWindowDetails details);
    Promise&lt;BrowserExtWindowsWindow&gt; get(unsigned short windowId, optional BrowserExtGetWindowDetails details);
    Promise&lt;sequence&lt;BrowserExtWindowsWindow&gt;&gt; getAll(optional BrowserExtGetWindowDetail details);
    Promise&lt;BrowserExtWindowsWindow&gt; getCurrent(optional BrowserExtGetWindowDetail details);
    Promise&lt;BrowserExtWindowsWindow&gt; getLastFocused(optional BrowserExtGetWindowDetail details);
    onFocusChanged(BrowserExtWindowsOnFocusChangedCallback callback);
    Promise&lt;BrowserExtWindowsWindow&gt; update(unsigned short windowId, optional BrowserExtWindowUpdateDetails details);
};
    
[NoInterfaceObject, Exposed=Window, CheckAnyPermissions_browserExt_]
interface BrowserExtWindowsAPI {
readonly attribute BrowserExtWindows windows; 
};
Browser implements BrowserExtWindowsAPI;
</pre>
                </section>
            </section>
        </section>

        <section class='informative'>
            <h3>Native Messaging</h3>
            <p>Native Messaging is covered in another specification. Refer to the Native Messaging for Browser Extensions specification [[browserext-native]] for more information.</p>
        </section>

</section>
    <section class='informative'>
        <h2 id="manifest-json">Manifest Format</h2>
        <section>
            <h3>Pre-parsing</h3>
            Standards-compliant browsers are expected to ignore "//" comments. Disregarding comments, the manifest.json file format for browser extensions is expected to be fully JSON compliant. Malformed JSON files are not supported.  If manifest keys that are not defined in this specification are specified, other browsers may ignore those keys.
        </section>
        <section>
            <h3>Permissions URL patterns</h3>
            <p class="issue">##28## Define how and where permission patterns are used<br /> </p>
        </section>
        <section>
            <h3>Full Example</h3>
<pre>
// Standards-compliant browsers are expected to ignore "//" comments. Disregarding comments, 
// the manifest.json file format for browser extensions is expected to be fully JSON compliant. 
// Malformed JSON files are not supported.
//
// Other manifest keys that are well-formed JSON but are not listed here must be ignored.
//
// Note that some fields marked as Optional here are required by vendor-specific distribution Stores.
{
  "name": "The Name of Your Extension",             // Required
  "version": "Your Extension Version",              // Required
  "default_locale": "en",                           // Required if locales are used. Otherwise, not allowed

  "description": "Description for Your Extensions",   
  "icons": {...},                                    
  "developer": {                                    
       "name": "Your Name or Company",              
       "url": "Company Website"                      
  }

  // Note: Some browsers require an extension to use either browser_action or page_action, but not both simultaneously
  "browser_action": {  
      "default_icon": {...},                        // Same format as "icons"
      "default_popup": "Page URL",
      "default_title": "Title string"
  },
  "page_action": {...},                             // Same format as "browser_action"
  
  "browser_specific_settings": {                    
       "&lt;browser_name&gt;": {                          // Examples "gecko","opera","edge"
            "&lt;key&gt;": "&lt;value&gt;"                      // Examples "strict_min_version": "42.0", "id": "addon@example.com"
       }
  },

  "background": {                                   
      "page": "Page URL",                           // Only one of "page" or "scripts" may be specified, but not both 
      "scripts": [],                                // Only one of "page" or "scripts" may be specified, but not both 
      "persistent": false                           // Required if "background" is specified
  },

  "content_scripts": {                                                    
      "all_frames": false,                          
      "css": [],                                   
      "exclude_matches": [],                        
      "js": [],                                     
      "matches": [],                                
      "run_at" : "document_start"                   // Also "document_end", "document_idle"
  }

  "content_security_policy": "&lt;policy-string&gt;",     
  
  "options_page": "Page URL",                            // Optional
  "manifest_version": 2,                            // Not used
  "required_keys": [],                              // If a browser does not recognize a key in the list, it must 
                                                    // reject the manifest (e.g. "sidebar_action")
                                                    // Future keys may be required to be in the list if used. 
                                                    // FEEDBACK: Rename to "required_capabilities"
  "permissions": {                                  
       "activeTab",                                                
       "contextMenus",                              
       "storage",                                   
       "tabs",                                      
       "webNavigation",                            
       "webRequest",                                
       "webRequestBlocking",                        
       "&lt;url-pattern&gt;"                              // Examples "http://*/*", "&lt;all_urls&gt;"
  },

  "web_accessible_resources": [...]    

  "externally_connectable" : [
       "ids":[...], // Identifiers for other extensions that are allowed to send messages
       "matches":[...] // URL patterns for hosted web pages allowed to send messages 
  ]                             
}
</pre>
        </section>
    </section>
    <section class='informative'>
        <h2>Extension Resources</h2>
        <section>
            <h3>The <code>browserext://</code> protocol</h3>
            <p>
                To access resources within the extension, such as <code>browserext://&lt;ext_id&gt;/options.html</code>, the <code>browserext://</code> protocol is used.
            </p>
        </section>
        <section>
            <h3>Extension IDs</h3>
            <p>
                Each extension has an extension ID that follows the <code>browserext://</code> protocol. For example
            </p>
            <p class="example">
                <code>browserext://MyExtension_c1wakc4j0nefm/options.html</code>
                <code>browserext://dfcijpibodeoenkablikbkiobbdnkfki/options.html</code>
            </p>
            <p>
                The algorithms that generate these IDs are different for each browser. To access these resources, do not hardcode the ID generated by a particular browser. Instead, use the <code>runtime.getURL()</code> method to convert a relative file name or path to the absolute name or path, which includes the extension ID.
            </p>
        </section>
    </section>
    <section class='informative'>
        <h2>Content Security Polity (CSP)</h2>
        The default CSP is discussed in the specification [[CSP3]] . 
        <p class="issue">##29## Complete this section, discussing special considerations for extensions and CSP.<br />  </p>
    </section>
        <section class='informative'>
            <h2>Testing Extensions with WebDriver</h2>
            <p>
                Browsers vendors may choose to implement WebDriver support in their browsers to allow for the automated testing of browser extensions. To implement this support, the browser must support:
            </p>
            <ul>
                <li>The base functionality as defined in the WebDriver specification [[webdriver]] </li>
                <li>Additional functionality required to support browser extensions, defined below in the Browser Extensions specification</li>
            </ul>
            <p class="issue">[ISSUE] (2016.09.22) ##31## Title should be enough to identify extension, but may want to add an extensionId or extensionName property. Will consult BE CG<br />  </p>
            <p class="issue">[ISSUE] (2016.09.22) ##33## Add extension during session at runtime<br /></p>
            <p class="issue">[ISSUE] (2016.09.22) ##34## For installing, you will need an endpoint for installing/activating at runtime<br /> </p>
            <p class="issue">[ISSUE] (2016.09.22) Support user permissions/prompts (Need to follow up with Kris)</p>
            <p class="issue">[ISSUE] (2016.09.22) Should be overlap with Permissions API – chat with them (need to discuss, not sure what this means)</p>
            <section class="informative">
                <h3>Protocol</h3>
                <section class='informative'>
                    <h4>List of Endpoints</h4>
                    <p>In addition to the endpoints defined in the WebDriver specification [[webdriver]], support for browser extensions requires these additional endpoints.</p>
                    <table class="simple">
                        <tbody>
                            <tr>
                                <th>Method</th>
                                <th>URI Template</th>
                                <th>Command</th>
                            </tr>
                            <tr>
                                <td>GET</td>
                                <td>/session/{<var>sessionId</var>}/browserext/actions</td>
                                <td>Get Browser Extension Actions</td>
                            </tr>
                            <tr>
                                <td>POST</td>
                                <td>/session/{<var>sessionId</var>}/browserext/actions/{<var>ExtensionActionID</var>}</td>
                                <td>Take Browser Extension Action</td>
                            </tr>
                            <tr>
                                <td>POST</td>
                                <td>/session/{<var>sessionId</var>}/element/{<var>element id</var>}/browserext/contextMenu</td>
                                <td>Select Browser Extension Context Menu</td>
                            </tr>
                            <tr>
                                <td>POST</td>
                                <td>/session/{<var>sessionId</var>}/element/{<var>element id</var>}/browserext/contextMenu/{<var>item</var>}</td>
                                <td>Select Browser Extension Context Menu Item</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
                <section class='informative'>
                    <h4>Handling Errors</h4>
                    <p>In addition to the codes defined in the Handling Errors section of the WebDriver specification [[webdriver]], support support for browser extensions requires support the following additional error codes:</p>
                    <table class="simple">
                        <tbody>
                            <tr>
                                <th>
                                    Error Code
                                </th>
                                <th>
                                    HTTP Status
                                </th>
                                <th>
                                    JSON Error Code
                                </th>
                                <th>
                                    Description
                                </th>
                            </tr>
                            <tr>
                                <td><dfn id="dfn-no-such-browser-extension" data-dfn-type="dfn">no such browser extension</dfn></td>
                                <td>400</td>
                                <td><code>no such browser extension</code></td>
                                <td>
                                    There is no available browser extension on the current page with the given id.
                                </td>
                            </tr>
                            <tr>
                                <td><dfn id="dfn-no-such-browser-extension-popup" data-dfn-type="dfn">no such browser extension popup</dfn></td>
                                <td>400</td>
                                <td><code>no such browser extension popup</code></td>
                                <td>
                                    A request to switch to a browser extension popup could not be satisfied because
                                    there is no browser extension popup currently open.
                                </td>
                            </tr>
                            <tr>
                                <td><dfn id="dfn-no-such-browser-extension-context-menu-item" data-dfn-type="dfn">no such browser extension context menu item</dfn></td>
                                <td>400</td>
                                <td><code>no such browser extension context menu item</code></td>
                                <td>
                                    A request to select an extension context menu item could not be completed
                                    because there is no matching extension context menu item for the given
                                    element.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </section>
                </section>
                <section class='informative'>
                    <h3>
                        Capabilities
                    </h3>
                    <p>In addition to the Capabilities defined in the WebDriver specification [[webdriver]], support support for browser extensions requires the following additional entry on the <i>server capabilities</i> JSON object:</p>
                    <dl>
                        <dt>
                            "<code>enabledExtensions</code>"
                        </dt>
                        <dd>
                            An array of relative paths which point to the location of browser extension files. The path <em title="MUST" class="rfc2119">MUST</em> point to either a single file appropriate for a specific brower (e.g. .crx) or a folder which contains the extension source files. If a folder is specified, the folder itself <em title="MUST" class="rfc2119">MUST</em> contain a <code>manifest.json</code> file. Subfolders containing <code>manifest.json</code> files will not be searched.
                        </dd>
                    </dl>
                    <section class='informative'>
                        <h4>Extension Lifetime</h4>
                        <p>No browser extension will be installed or pre-loaded during a WebDriver session unless it is explicitly specified in the <code>enabledExtensions</code> array. Browser extensions loaded during the session will not be available to other active instances of the browser that are not part of the WebDriver session. When the session ends, the array of browser extensions are unloaded and uninstalled.</p>
                    </section>
                </section>
                <section class='informative'>
                    <h3>
                        Browser Extensions Commands
                    </h3>
                    <p>Users interact with extensions through several means. First there are actions embedded in the chrome of the browser, which can do something directly or open a popup. If the extension uses a popup, it can contain any html content. Finally, extensions can add items to the browser's context menu. WebDriver needs to be able to emulate user actions for all three of these controls in order to completely emulate user interaction.</p>
                    <p>In addition to the commands defined in the WebDriver specification [[webdriver]], support support for browser extensions requires the following additional commands. </p>
                    <section>
                        <h3><code>getBrowserExtensionActions()</code></h3>
                        <table class="simple jsoncommand">
                            <tbody>
                                <tr>
                                    <th>HTTP Method</th>
                                    <th>Path Template</th>
                                    <th>Notes</th>
                                </tr>
                                <tr>
                                    <td>GET</td>
                                    <td id="get-browser-extension-actions">/session/{<var>sessionId</var>}/browserext/actions</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <p>
                            This command returns a list of browser extension actions
                            available on the current page. Note that this can change from page to page.
                            It MUST return a list of objects which describes the available browser extension
                            actions using the following algorithm for each action:

                        </p><ul>
                            <li><p>Let <var>action</var> be a new JSON Object.</p></li>

                            <li>
                                <p>
                                    Set the property <code>id</code> on <var>action</var> to a
                                    string which is unique for the current session.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Set the property <code>actionTitle</code> on <var>action</var> to the
                                    mouseover text for the action.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Set the property <code>icon</code> on <var>action</var> to the
                                    filename of the icon file or an empty string if none is displayed. If the
                                    icon is dynamically generated, the current icon MUST be returned as a
                                    lossless PNG image encoded using Base64.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Set the property <code>badgeText</code> on <var>action</var> to the
                                    badge text displayed over the action or an empty string if none is
                                    present.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Return <code>success</code> with <var>data</var> action
                                </p>
                            </li>
                        </ul>
                        <p></p>
                    </section>
                    <section>
                        <h3><code>takeBrowserExtensionAction()</code></h3>
                        <table class="simple jsoncommand">
                            <tbody>
                                <tr>
                                    <th>HTTP Method</th>
                                    <th>Path Template</th>
                                    <th>Notes</th>
                                </tr>
                                <tr>
                                    <td>POST</td>
                                    <td id="take-browser-extension-action">/session/{<var>sessionId</var>}/browserext/action/{<var>browserExtensionActionId</var>}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <p>
                            This command causes a browser extension to be activated, as if
                            the user had clicked the browser extension's browser action icon in the browser's chrome. Depending
                            on the browser extension, this may cause a popup to be opened.
                        </p>
                        <dl class="parameters">
                            <dt>DOMString browserExtensionActionId</dt>
                            <dd>
                                The unique identifier of the browser extension action to be taken, as returned
                                by the <code>getBrowserExtensionActions()</code> command.
                            </dd>
                        </dl>
                        <p>
                            If the id specified does not correspond to a browser extension on the current
                            page, a
                            <code><a href="#status-no-such-browser-extension">no such browser extension</a></code>
                            status code MUST be returned.
                        </p>
                    </section>
                    <section>
                        <!-- getExtensionContextMenuItems() -->
                        <h3><code>selectBrowserExtensionContextMenu()</code></h3>
                        <table class="simple jsoncommand">
                            <tbody>
                                <tr>
                                    <th>HTTP Method</th>
                                    <th>Path Template</th>
                                    <th>Notes</th>
                                </tr>
                                <tr>
                                    <td>POST</td>
                                    <td id="get-browser-extension-context-menu-items">/session/{<var>sessionId</var>}/element/{<var>elementId</var>}/browserext/contexMenu</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <p>
                            This command opens a context menu for
                            a given element. It MUST return a list of objects which describes the
                            available context menu items using the following algorithm for each menu
                            item:

                        </p><ul>
                            <li><p>Let <var>menuitem</var> be a new JSON Object.</p></li>

                            <li>
                                <p>
                                    Set the property <code>id</code> on <var>menuitem</var> to a
                                    string which is unique for the current session.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Set the property <code>menuItemTitle</code> on <var>menuitem</var> to the
                                    text that is displayed in the UI.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Set the property <code>icon</code> on <var>menuitem</var> to the
                                    filename of the icon file or an empty string if none is displayed.

                                    If the icon is set because of the type of the context menu item (such as
                                    a radio button or checkbox), the <code>icon</code> property MUST be set
                                    to a string which is consistent for all icons of that type and status
                                    (e.g. checked), including across sessions.
                                </p>
                            </li>

                            <li>
                                <p>
                                    Set the property <code>parent</code> on <var>menuitem</var> to the
                                    id of the item's parent or an empty string if the menuitem does not have
                                    a parent.
                                </p>
                            </li>
                            <li>
                                <p>
                                    Set the property <code>itemType</code> on <var>menuitem</var> to a string value identifying the control type.
                                </p>
                                <table class="simple">
                                    <tbody>
                                        <tr>
                                            <th>
                                                String Value
                                            </th>
                                            <th>
                                                Description
                                            </th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <code>checkbox</code>
                                            </td>
                                            <td>
                                                A checkbox element
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <code>normal</code>
                                            </td>
                                            <td>
                                                A standard menuItem element (text label)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <code>radio</code>
                                            </td>
                                            <td>
                                                A radio element. Within a radio group, only one menuItem may have a value of <code>true</code>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <code>separator</code>
                                            </td>
                                            <td>
                                                A horizontal line separator, typically used between groups of related items such as radio groups
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </li>
                            <li>
                                <p>
                                    Set the property <code>itemChecked</code> on <var>menuitem</var> to a boolean value indicating
                                    state of the item according to the following table. This applies only to items of itemType <code>checkbox</code> or <code>radio</code>. Within a radio group, only one menuItem may have a value of <code>true</code>.
                                </p>
                                <table class="simple">
                                    <tbody>
                                        <tr>
                                            <th>
                                                Boolean Value
                                            </th>
                                            <th>
                                                Description
                                            </th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <code>true</code>
                                            </td>
                                            <td>
                                                Selected
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <code>false</code>
                                            </td>
                                            <td>
                                                Not selected
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </li>
                            <li>
                                <p>
                                    Return <code>success</code> with data <var>menuitem</var>
                                </p>
                            </li>
                        </ul>

                        This list MUST contain all context menu items added by browser extensions and
                        MUST NOT contain any other context menu items.
                        <p></p>
                        <p>
                            After this command has been run, the context menu MUST remain open until the
                            next command that dismisses it (e.g. clicking, navigation) has been run.
                        </p>
                        <dl class="parameters">
                            <dt>WebElement elementId</dt>
                            <dd>
                                The id of the element for which the context menu should be opened.
                            </dd>
                        </dl>
                    </section>
                    <section>
                        <!-- selectExtensionContextMenuItem() -->
                        <h3><code>selectBrowserExtensionContextMenuItem()</code></h3>
                        <table class="simple jsoncommand">
                            <tbody>
                                <tr>
                                    <th>HTTP Method</th>
                                    <th>Path Template</th>
                                    <th>Notes</th>
                                </tr>
                                <tr>
                                    <td>POST</td>
                                    <td id="get-browser-extension-context-menu-items">/session/{<var>sessionId</var>}/element/{<var>elementId</var>}/browserext/contextMenu/{<var>menuitemId</var>}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <p>
                            This command causes a context menu
                            item to be selected. This MUST have the same effect as a user clicking or
                            tapping the item in the open context menu.

                            If the menu item is a parent of other menu items, this command MAY open a
                            submenu, but MUST NOT have any other effect.
                        </p>
                        <p>
                            This command MUST be executed even if there is no context menu open.
                        </p>
                        <dl class="parameters">
                            <dt>String menuitemId</dt>
                            <dd>
                                The context menu item id, as returned by the
                                <code>selectBrowserExtensionContextMenu()</code>
                                command.
                            </dd>
                        </dl>
                        <p>
                            If no popup is currently open, a
                            <code><a href="#status-no-such-browser-extension-context-menu-item">no such extension context menu item</a></code>
                            status code MUST be returned.
                        </p>
                    </section>
                </section>
            </section>
            <section class='informative'>
                <h2>Packaging</h2>
                <p>
                    Browser extensions may be distributed and subsequently loaded as individual files or via a container, such as a *.zip archive. Regardless of the packaging format, these containers must contain the following:
                </p>
                <ul>
                    <li>manifest.json</li>
                    <li>Necessary JavaScript files (&lt;filename&gt;.js)</li>
                </ul>
                <section class='informative'>
                    <h3>Digital signatures</h3>
                    <p class="issue">
                        This is TBD.
                    </p>
                </section>
            </section>
        <section class="appendix" >
            <h2 id="acknowledgements">Acknownledgements</h2>
            <p>
                Many thanks to the members of the <a href="https://www.w3.org/community/browserext/">Browser Extension Community Group</a> for their detailed feedback on this specification. Thanks to the members of the <a href="http://www.w3.org/testing/browser/">Browser Testing and Tools Working Group</a> for their recommendations and feedback on WebDriver support.
            </p>
            <p>Some sections are reproduced from MDN:</p>
            <ul>
                <li><a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Internationalization">https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Internationalization</a></li>
                <li><a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/i18n/Locale-Specific_Message_reference">https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/i18n/Locale-Specific_Message_reference</a></li>
            </ul>
        </section>
    <script>
        function updateResolved() {
            var e = document.getElementsByClassName("issue");
            var n = e.length;
            for (var i = 0; i < n; i++) {
                if (e[i].innerText.indexOf("[RESOLVED]") > 0) {
                    e[i].style.backgroundColor = "rgb(170,255,170)";
                }
                if (i <= 1) {
                    e[i].innerHTML += "<a href='#issue-1'>1</a> &nbsp; <a href='#issue-2'>2</a>  &nbsp; <a href='#issue-3'>3</a>  &nbsp;...&nbsp; <a href='#issue-" + (n) + "'>" + (n).toString() + "</a> ";
                }
                else if (i == (n-1)) {
                    e[i].innerHTML += "<a href='#issue-1'>1</a> &nbsp;...&nbsp; <a href='#issue-" + (i) + "'>" + (i).toString() + "</a> &nbsp;" + (i + 1).toString();
                } else {
                    e[i].innerHTML += "<a href='#issue-1'>1</a> &nbsp;...&nbsp; <a href='#issue-" + (i) + "'>" + (i).toString() + "</a> &nbsp;" + (i + 1).toString() + "&nbsp; <a href='#issue-" + (i + 2) + "'>" + (i + 2).toString() + "</a>  &nbsp;...&nbsp; <a href='#issue-" + (n) + "'>" + (n).toString() + "</a> ";
                }
            }
        }
        function updateCheckAnyPermissions() {
            var checkAnyPermissionsTokenPrefix = "CheckAnyPermissions_";
            var checkAnyPermissionsTokenPrefixReplaceWith = 'CheckAnyPermissions="';
            var checkAnyPermissionsTokenSuffix = "_";
            var e = document.body.getElementsByTagName("pre");
            var n = e.length;
            var q1 = -1;

            for (var i = 0; i < n; i++) {
                var s = e[i].innerHTML;
                if (s.indexOf(checkAnyPermissionsTokenPrefix) >= 0) {
                    q1 = s.indexOf(checkAnyPermissionsTokenPrefix) + checkAnyPermissionsTokenPrefix.length;
                    q2 = s.indexOf(checkAnyPermissionsTokenSuffix, q1);
                    s = s.substring(0, q2) + '"' + s.substring(q2 + 1, s.length);
                    e[i].innerHTML = s.replace(checkAnyPermissionsTokenPrefix, checkAnyPermissionsTokenPrefixReplaceWith);
                }
            }
        }

        // document.getElementsByClassName("issue-title marker")[0].childNodes[0].innerHTML = "<a href='https://github.com/browserext/browserext/issues/'>ISSUE 32</a>"
        function updateGithubIssues() {
            var githubIssueTokenPrefix = "##";
            var githubIssueTokenSuffix = "##";
            var e = document.body.getElementsByClassName("issue");
            var n = e.length;
            var q1 = -1;

            for (var i = 0; i < n; i++) {
                var s = e[i].innerHTML;
                if (s.indexOf(githubIssueTokenPrefix) >= 0) {
                    q1 = s.indexOf(githubIssueTokenPrefix) + githubIssueTokenPrefix.length;
                    q2 = s.indexOf(githubIssueTokenSuffix, q1);
                    s = s.substring(0, q2) + '">GitHub #' + s.substring(q1,q2) + "</a>" + s.substring(q2 + 2, s.length);
                    e[i].innerHTML = s.replace(githubIssueTokenPrefix, '<a href="https://github.com/browserext/browserext/issues/');

                }
            }
        }

        function checkRespecReady() {
            if (document.respecIsReady == null) {
                setTimeout("checkRespecReady()", 1000);
            }
            else {
                document.respecIsReady.then(function () {
                    updateResolved();
                    updateCheckAnyPermissions();
                    updateGithubIssues();
                });
            }
        }

        checkRespecReady();      
    </script>
</body>
</html>
